# =============================================================================
# Palestine Catwatch - Environment Variables
# =============================================================================
# Copy this file to .env and fill in your values
# NEVER commit .env to version control!
# =============================================================================

# ============================================
# Environment
# ============================================
# Set to 'production' or 'prod' in production to enable security validations
ENVIRONMENT=development

# ============================================
# CORS Configuration
# ============================================
# Comma-separated list of allowed origins for cross-origin requests
# In production, set this to your actual frontend domain(s)
# Example: ALLOWED_ORIGINS=https://example.com,https://www.example.com
# Note: In development mode, CORS allows all origins regardless of this setting
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173

# =============================================================================
# DATABASE
# =============================================================================

# PostgreSQL connection string (required)
# Format: postgresql://user:password@host:port/database?sslmode=require
# For Neon: postgresql://user:password@ep-xxx.region.aws.neon.tech/neondb?sslmode=require
DATABASE_URL=postgresql://user:password@localhost:5432/protest_db

# =============================================================================
# AUTHENTICATION & SECURITY
# =============================================================================

# JWT Secret Key (REQUIRED for production)
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
# MUST be changed from default in production!
JWT_SECRET_KEY=dev-secret-key-change-in-production

# Refresh token secret (7-day tokens) - MUST be different from JWT_SECRET_KEY
JWT_REFRESH_SECRET_KEY=your-refresh-secret-key-here-min-32-chars

# JWT Token Expiration
JWT_EXPIRE_MINUTES=30
JWT_REFRESH_EXPIRE_DAYS=7

# ============================================
# Email Verification
# ============================================
# Set to 'false' to disable email verification requirement (for development)
REQUIRE_EMAIL_VERIFICATION=true

# ============================================
# Account Security
# ============================================
# Account lockout after failed login attempts
MAX_FAILED_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=15
FAILED_LOGIN_RESET_MINUTES=30

# CSRF Protection (disable for development if needed)
CSRF_ENABLED=true

# ============================================
# Database Migrations
# ============================================
# Required to run destructive migrations (e.g., dropping tables with data)
# Set to 'true' ONLY when you intentionally want to delete data
ALLOW_DESTRUCTIVE_MIGRATION=false

# =============================================================================
# ANTHROPIC API (Claude Vision)
# =============================================================================

# Anthropic API key for uniform recognition feature
# Required for Claude Vision API to analyze police uniforms, equipment, and insignia.
# Get your key at: https://console.anthropic.com/
# Cost: ~$0.015 per image analysis (Claude claude-sonnet-4-20250514 with vision)
ANTHROPIC_API_KEY=sk-ant-api03-...

# Auto-analyze uniforms during processing
# true: Every detected officer is automatically analyzed (higher API costs)
# false: Analysis is on-demand only via /appearances/{id}/analyze endpoint
# Default: false (to prevent unexpected API charges)
ENABLE_AUTO_UNIFORM_ANALYSIS=false

# Rate limit for uniform analysis API calls (requests per minute)
# Lower values (5-10): Safer for cost control, slower processing
# Higher values (20-30): Faster processing, higher potential costs
# Default: 10
UNIFORM_ANALYSIS_RATE_LIMIT=10

# =============================================================================
# RATE LIMITING & DOS PROTECTION
# =============================================================================

# Maximum concurrent AI processing tasks per IP address
# Prevents single users from consuming all processing resources
# Default: 3
MAX_CONCURRENT_AI_TASKS=3

# Maximum upload sizes (in MB)
# Default: 50MB for images, 500MB for videos
MAX_IMAGE_SIZE_MB=50
MAX_VIDEO_SIZE_MB=500

# =============================================================================
# SOCKET.IO ROOM MANAGEMENT
# =============================================================================

# Delay (seconds) before cleaning up completed task rooms
# Default: 300 (5 minutes)
SIO_ROOM_CLEANUP_DELAY=300

# Maximum age (hours) for any room before forced cleanup
# Prevents memory leaks from abandoned sessions
# Default: 24
SIO_ROOM_MAX_AGE_HOURS=24

# How often (seconds) to run the cleanup sweep
# Default: 3600 (1 hour)
SIO_CLEANUP_INTERVAL=3600

# Maximum number of concurrent tracked rooms
# Memory protection limit
# Default: 1000
SIO_MAX_ROOMS=1000

# =============================================================================
# FACE MATCHING
# =============================================================================

# Face matching mode: strict, moderate, or loose
# strict: 0.60 threshold - Very few false positives, may miss matches
# moderate: 0.70 threshold - Balanced (recommended)
# loose: 0.80 threshold - More matches, more false positives
# Default: moderate
FACE_MATCH_MODE=moderate

# =============================================================================
# YOUTUBE DOWNLOAD (cookies.txt)
# =============================================================================
# For best YouTube download reliability, export browser cookies to backend/cookies.txt
#
# WHY: YouTube blocks automated downloads. Browser cookies prove you're a real user
#      and bypass age restrictions, geo-blocks, and bot detection.
#
# HOW TO EXPORT COOKIES:
# 1. Install browser extension: "Get cookies.txt LOCALLY" (Chrome/Firefox)
# 2. Go to youtube.com and ensure you're logged in
# 3. Click the extension icon and "Export" cookies
# 4. Save as: backend/cookies.txt (Netscape format)
#
# SECURITY NOTE: cookies.txt contains session tokens - keep it private!
# The file is already in .gitignore to prevent accidental commits.
#
# WITHOUT COOKIES: Many videos will fail with "403 Forbidden" errors
# WITH COOKIES: Most public YouTube videos should download successfully

# =============================================================================
# LOGGING
# =============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Default: INFO
LOG_LEVEL=INFO

# Log format: json (structured) or text (human-readable)
# Use "json" for production (parseable by log aggregators)
# Use "text" for development (colored, readable)
# Default: json
LOG_FORMAT=text

# Optional log file path (in addition to stdout)
# LOG_FILE=/var/log/palestine-catwatch/app.log

# =============================================================================
# FRONTEND
# =============================================================================
# (Set these in frontend/.env or at build time)

# API URL for frontend to connect to backend
# VITE_API_URL=http://localhost:8000

# =============================================================================
# PRODUCTION CHECKLIST
# =============================================================================
# Before deploying to production, ensure:
# [ ] JWT_SECRET_KEY is changed to a secure random value
# [ ] JWT_REFRESH_SECRET_KEY is changed to a secure random value
# [ ] DATABASE_URL points to production database
# [ ] ANTHROPIC_API_KEY is valid (if using uniform analysis)
# [ ] Rate limits are appropriate for expected traffic
# [ ] MAX_CONCURRENT_AI_TASKS is set based on server capacity
# [ ] SIO_MAX_ROOMS is set based on expected concurrent users
# [ ] ALLOWED_ORIGINS is set to production domains
